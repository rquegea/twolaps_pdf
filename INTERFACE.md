# Interfaz Web - TwoLaps Intelligence Platform

Gu√≠a completa de la interfaz web interactiva construida con Streamlit.

## üöÄ Inicio R√°pido

```bash
# Opci√≥n 1: Comando directo
streamlit run app.py

# Opci√≥n 2: Script de inicio
./start_interface.sh      # Mac/Linux
start_interface.bat       # Windows
```

**URL**: http://localhost:8501

---

## üì± P√°ginas y Funcionalidades

### üè† **Dashboard Principal**

**Qu√© muestra:**
- 4 m√©tricas clave en cards:
  - N√∫mero de mercados activos
  - N√∫mero de categor√≠as activas
  - Queries activas totales
  - Informes generados
- Estad√≠sticas de ejecuciones del mes actual:
  - Total de ejecuciones
  - Distribuci√≥n por proveedor (OpenAI, Anthropic, Google)
- Dashboard de costes:
  - Total gastado vs. presupuesto
  - Barra de progreso con alertas autom√°ticas
- √öltimas 10 ejecuciones con detalles
- √öltimos 5 informes generados

**Uso t√≠pico:**
- Vista general del sistema al iniciar sesi√≥n
- Monitoreo r√°pido de costes
- Acceso r√°pido a informes recientes

---

### üìä **Mercados & Categor√≠as**

**Qu√© muestra:**
- Vista jer√°rquica expandible por mercado
- Para cada categor√≠a:
  - N√∫mero de queries configuradas
  - N√∫mero de marcas monitoreadas
  - N√∫mero de informes generados

**Uso t√≠pico:**
- Entender la estructura completa del sistema
- Verificar qu√© categor√≠as est√°n configuradas
- Identificar categor√≠as sin queries o marcas

**Ejemplo:**
```
üìä FMCG
  ‚îú‚îÄ‚îÄ Cervezas (8 queries, 10 marcas, 2 informes)
  ‚îú‚îÄ‚îÄ Refrescos (10 queries, 10 marcas, 1 informe)
  ‚îî‚îÄ‚îÄ Rones (8 queries, 9 marcas, 0 informes)
```

---

### ‚ùì **Queries**

**Qu√© muestra:**
- Listado completo de todas las queries configuradas
- Filtros:
  - Por mercado (dropdown)
  - Por categor√≠a (dropdown din√°mico)
- Para cada query:
  - Texto de la pregunta
  - Frecuencia de ejecuci√≥n (daily, weekly, monthly)
  - Proveedores configurados (openai, anthropic, google)
  - √öltima ejecuci√≥n (fecha y hora)
  - N√∫mero total de ejecuciones hist√≥ricas

**Uso t√≠pico:**
- Revisar qu√© preguntas est√°n activas
- Verificar cu√°ndo fue la √∫ltima ejecuci√≥n
- Identificar queries que nunca se han ejecutado
- Planificar nuevas queries bas√°ndose en las existentes

**Vista detallada:**
```
[FMCG/Cervezas] ¬øCu√°l es la mejor cerveza artesanal en 2025?
  Frecuencia: weekly
  Proveedores: openai, anthropic, google
  √öltima Ejecuci√≥n: 2025-10-15 14:30
  Ejecuciones totales: 24
```

---

### üè∑Ô∏è **Marcas**

**Qu√© muestra:**
- Todas las marcas monitoreadas organizadas por categor√≠a
- Clasificaci√≥n en 3 tipos:
  - **L√≠deres**: Marcas dominantes del mercado
  - **Competidores**: Marcas establecidas
  - **Emergentes**: Marcas nuevas o en crecimiento
- Filtro por mercado

**Uso t√≠pico:**
- Verificar qu√© marcas se est√°n monitoreando
- Asegurar que no falta ninguna marca importante
- Planificar adici√≥n de nuevas marcas

**Ejemplo visual:**
```
üè∑Ô∏è FMCG/Cervezas
  L√≠deres:          Competidores:     Emergentes:
  ‚Ä¢ Heineken        ‚Ä¢ Amstel          ‚Ä¢ La Virgen
  ‚Ä¢ Corona          ‚Ä¢ Cruzcampo       ‚Ä¢ Moritz
  ‚Ä¢ Mahou           ‚Ä¢ San Miguel
```

---

### ü§ñ **Ejecuciones**

**Qu√© muestra:**
- Historial completo de ejecuciones de queries
- **Filtros avanzados:**
  - √öltimos: 1, 7, 30, 90 d√≠as
  - Por proveedor (Todos, openai, anthropic, google)
  - L√≠mite de resultados (10-1000)
- **Estad√≠sticas agregadas:**
  - Coste total del filtro seleccionado
  - Tokens totales (entrada + salida)
  - Latencia media en milisegundos
  - N√∫mero total de ejecuciones
- **Tabla detallada** con:
  - ID de ejecuci√≥n
  - Texto de la query (truncado)
  - Proveedor y modelo usado
  - Timestamp
  - Tokens in/out
  - Coste individual
  - Latencia

**Uso t√≠pico:**
- Auditar ejecuciones recientes
- Identificar queries costosas
- Analizar rendimiento por proveedor
- Verificar que el sistema est√° ejecutando correctamente

**M√©tricas ejemplo:**
```
√öltimos 30 d√≠as - OpenAI
Coste Total: $45.23
Tokens Totales: 1,234,567
Latencia Media: 2,340ms
Total: 234 ejecuciones
```

---

### üìà **An√°lisis**

**Qu√© muestra:**
- Resultados de los 7 agentes de an√°lisis por periodo
- Filtros por mercado y categor√≠a
- Agrupaci√≥n por periodo (YYYY-MM)
- **Para cada periodo:**
  - Lista de agentes ejecutados
  - M√©tricas clave por agente:
    
    **Quantitative:**
    - Total de menciones
    - Marcas mencionadas
    - Tabla de SOV (Share of Voice) por marca
    
    **Sentiment:**
    - Sentimiento global (-1 a 1)
    
    **Competitive:**
    - Marca l√≠der identificada
    
    **Strategic:**
    - N√∫mero de oportunidades detectadas
    - N√∫mero de riesgos identificados

**Uso t√≠pico:**
- Revisar an√°lisis antes de generar informe
- Verificar que todos los agentes ejecutaron correctamente
- Comparar m√©tricas entre periodos
- Entender el SOV actual

**Ejemplo visual:**
```
üìÖ 2025-10 (Agentes ejecutados: 7)

Quantitative:
  Total Menciones: 247
  Marcas Mencionadas: 8
  
  Share of Voice:
  Heineken    35.2%
  Corona      28.3%
  Mahou       15.1%
  ...

Sentiment:
  Sentimiento Global: 0.72

Strategic:
  Oportunidades: 5
  Riesgos: 3
```

---

### üìÑ **Informes**

**Qu√© muestra:**
- Listado de todos los informes generados
- Ordenados por fecha (m√°s reciente primero)
- **Para cada informe:**
  - Mercado/Categor√≠a
  - Periodo (YYYY-MM)
  - Estado:
    - ‚úÖ Publicado
    - üìù Borrador
  - Timestamp de generaci√≥n
  - Disponibilidad de PDF
  - Generado por (versi√≥n del agente ejecutivo)
  - **M√©tricas de calidad:**
    - N√∫mero de hallazgos
    - N√∫mero de oportunidades
    - N√∫mero de riesgos
    - N√∫mero de acciones en plan 90 d√≠as
  - **Preview del resumen ejecutivo:**
    - Hallazgos clave (bullets)

**Uso t√≠pico:**
- Revisar informes generados
- Verificar calidad de los informes
- Acceder a PDFs generados
- Identificar informes que necesitan regeneraci√≥n

**Ejemplo:**
```
üìÑ FMCG/Cervezas - 2025-10
  Estado: ‚úÖ Publicado
  Generado: 2025-10-17 15:45
  PDF: ‚úÖ Disponible
  Generado por: executive_agent_v1.0
  
  M√©tricas de Calidad:
  Hallazgos: 5  Oportunidades: 4  Riesgos: 3  Plan Acciones: 5
  
  Resumen Ejecutivo:
  ‚Ä¢ Heineken mantiene liderazgo con 35% SOV
  ‚Ä¢ Corona muestra tendencia positiva (+5% vs mes anterior)
  ‚Ä¢ Detectada oportunidad en segmento premium
  ...
```

---

### üí∞ **Costes**

**Qu√© muestra:**
- **Dashboard del mes actual:**
  - Total gastado (USD)
  - Presupuesto configurado (USD)
  - Porcentaje usado
  - Restante
  - Barra de progreso visual
  - **Alertas autom√°ticas:**
    - Verde: < 60% usado ‚úÖ
    - Amarillo: 60-80% usado ‚ö†Ô∏è
    - Rojo: > 80% usado üö®

- **Desglose por proveedor:**
  - Tabla con costes individuales
  - Porcentaje del total por proveedor
  - Gr√°fico de barras comparativo

**Uso t√≠pico:**
- Monitorear gastos mensuales
- Prevenir sobrecostes
- Optimizar uso de proveedores
- Justificar presupuesto

**Ejemplo visual:**
```
üí∞ Mes Actual (2025-10)

Total Gastado: $245.30
Presupuesto: $500.00
Usado: 49.1%
Restante: $254.70

[===============>                ] 49.1%

‚úÖ Presupuesto bajo control

Por Proveedor:
OpenAI      $120.45   49%
Anthropic   $95.20    39%
Google      $29.65    12%
```

---

### ‚öôÔ∏è **Ejecutar**

**Funcionalidad principal**: Lanzar acciones directamente desde la interfaz.

#### **Tab 1: Ejecutar Queries** ü§ñ

**Qu√© hace:**
- Ejecuta todas las queries activas de una categor√≠a
- Contra todos los proveedores configurados
- Guarda respuestas en base de datos
- Calcula y registra costes

**Pasos:**
1. Seleccionar Mercado (dropdown)
2. Seleccionar Categor√≠a (dropdown)
3. Hacer clic en "üöÄ Ejecutar Queries"
4. **Resultado:**
   - Spinner mientras ejecuta
   - Mensaje de √©xito
   - 3 m√©tricas:
     - Queries ejecutadas
     - Respuestas obtenidas (queries √ó proveedores)
     - Coste total

**Ejemplo de uso:**
```
Mercado: FMCG
Categor√≠a: Cervezas

[üöÄ Ejecutar Queries]

‚è≥ Ejecutando queries...

‚úÖ Ejecuci√≥n completada!
  Queries Ejecutadas: 8
  Respuestas Obtenidas: 24
  Coste Total: $0.4521
```

#### **Tab 2: Generar Informe** üìÑ

**Qu√© hace:**
- Ejecuta los 7 agentes de an√°lisis en secuencia
- Lee las respuestas de la BD del periodo seleccionado
- Genera s√≠ntesis consultiva con el agente ejecutivo
- Crea PDF profesional de 15-20 p√°ginas
- Guarda todo en base de datos

**Pasos:**
1. Seleccionar Mercado
2. Seleccionar Categor√≠a
3. Ingresar Periodo (YYYY-MM)
4. Hacer clic en "üìÑ Generar Informe"
5. **Proceso (varios minutos):**
   - An√°lisis cuantitativo
   - An√°lisis de sentimiento (con LLM)
   - An√°lisis de atributos
   - An√°lisis competitivo
   - Detecci√≥n de tendencias
   - An√°lisis estrat√©gico
   - S√≠ntesis ejecutiva
   - Generaci√≥n de PDF
6. **Resultado:**
   - Report ID
   - Ruta del PDF generado

**Tiempo estimado:**
- An√°lisis: 2-3 minutos
- Generaci√≥n PDF: 10-30 segundos
- **Total: 3-4 minutos**

**Ejemplo de uso:**
```
Mercado: FMCG
Categor√≠a: Cervezas
Periodo: 2025-10

[üìÑ Generar Informe]

‚è≥ Generando informe... Esto puede tardar varios minutos

  Ejecutando an√°lisis multi-agente...
  ‚úì Quantitative
  ‚úì Sentiment
  ‚úì Attributes
  ‚úì Competitive
  ‚úì Trends
  ‚úì Strategic
  ‚úì Executive

  Generando PDF...

‚úÖ An√°lisis completado (Report ID: 123)
‚úÖ Informe generado exitosamente!
üìÅ data/reports/FMCG_Cervezas_2025-10.pdf
```

---

## üé® Caracter√≠sticas de UX

### **Estilos Visuales**
- Gradient cards para m√©tricas importantes
- Color coding:
  - Verde: √âxito, valores positivos
  - Amarillo: Advertencias
  - Rojo: Errores, alertas cr√≠ticas
  - Azul: Acciones primarias
- Iconos emoji para mejor navegaci√≥n
- Cards expandibles para informaci√≥n detallada

### **Responsividad**
- Layout de columnas que se adapta
- Tablas con scroll horizontal
- M√©tricas en grids responsivos

### **Interactividad**
- Filtros din√°micos en tiempo real
- Dropdowns dependientes (mercado ‚Üí categor√≠a)
- Botones con spinners durante procesamiento
- Progress bars para operaciones largas
- Expandables para detalles bajo demanda

---

## üí° Tips de Uso

### **Para Monitoreo Diario:**
1. Ir a üè† Dashboard
2. Revisar costes del mes
3. Ver √∫ltimas ejecuciones
4. Verificar alertas

### **Para An√°lisis de Datos:**
1. Ir a üìà An√°lisis
2. Seleccionar categor√≠a
3. Revisar m√©tricas por agente
4. Comparar periodos

### **Para Generar Informes:**
1. Primero ejecutar queries en ‚öôÔ∏è Ejecutar
2. Esperar a que terminen (ver en ü§ñ Ejecuciones)
3. Luego generar informe en ‚öôÔ∏è Ejecutar
4. Revisar resultado en üìÑ Informes

### **Para Gesti√≥n de Costes:**
1. Ir a üí∞ Costes
2. Revisar progreso vs presupuesto
3. Analizar distribuci√≥n por proveedor
4. Ajustar frecuencias si es necesario

---

## ‚öôÔ∏è Configuraci√≥n Avanzada

### **Puerto Personalizado**
```bash
streamlit run app.py --server.port=8502
```

### **Acceso Remoto**
```bash
streamlit run app.py --server.address=0.0.0.0 --server.port=8501
```

### **Sin Auto-Abrir Navegador**
```bash
streamlit run app.py --server.headless=true
```

---

## üêõ Troubleshooting

### **Error: "No module named streamlit"**
```bash
pip install streamlit plotly
```

### **Puerto 8501 ocupado**
```bash
streamlit run app.py --server.port=8502
```

### **Base de datos no conecta**
- Verificar que PostgreSQL est√° corriendo
- Verificar `DATABASE_URL` en `.env`
- Probar: `python main.py test-db`

### **No se ven datos**
- Verificar que has ejecutado: `python main.py admin seed-fmcg`
- Verificar que hay ejecuciones de queries
- Refrescar la p√°gina (F5)

---

## üöÄ Ventajas de la Interfaz

‚úÖ **No necesitas memorizar comandos CLI**  
‚úÖ **Visualizaci√≥n inmediata de datos**  
‚úÖ **Ejecuci√≥n de tareas con un clic**  
‚úÖ **Monitoreo de costes en tiempo real**  
‚úÖ **Filtros y b√∫squedas interactivas**  
‚úÖ **No requiere conocimientos t√©cnicos**  
‚úÖ **Ideal para presentaciones y demos**  

---

**¬øListo para explorar?** üéâ

```bash
streamlit run app.py
```

